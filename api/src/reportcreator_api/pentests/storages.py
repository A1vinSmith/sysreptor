from urllib.parse import urljoin
from django.conf import settings
from django.core.files.storage import get_storage_class
from reportcreator_api.archive.crypto.storage import EncryptedStorageMixin

from reportcreator_api.utils.storages import FileSystemOverwriteStorage


class UploadedImageFileSystemStorage(EncryptedStorageMixin, FileSystemOverwriteStorage):
    def __init__(self) -> None:
        super().__init__(location=settings.UPLOADED_IMAGE_LOCATION, base_url=urljoin(settings.MEDIA_URL, 'uploadedimages'))


class UploadedAssetFileSystemStorage(EncryptedStorageMixin, FileSystemOverwriteStorage):
    def __init__(self) -> None:
        super().__init__(location=settings.UPLOADED_ASSET_LOCATION, base_url=urljoin(settings.MEDIA_URL, 'uploadedassets'))


def get_uploaded_image_storage():
    return get_storage_class(settings.UPLOADED_IMAGE_STORAGE)()


def get_uploaded_asset_storage():
    return get_storage_class(settings.UPLOADED_ASSET_STORAGE)()
